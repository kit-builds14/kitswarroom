<!DOCTYPE html>
<html lang="en">
<head><script src="../auth.js"></script><link rel="stylesheet" href="../responsive.css">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Agent Performance Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--navy:#1B2A4A;--navy-light:#243556;--navy-lighter:#2D4168;--gold:#C5A55A;--gold-dim:#A08A4A;--text:#E8E6E1;--text-dim:#8899AA;--success:#4ADE80;--fail:#F87171;--in-progress:#60A5FA;--bg:#0F1A2E}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:20px}
h1{font-size:1.8rem;font-weight:300;letter-spacing:2px;color:var(--gold);text-align:center;margin-bottom:6px}
.subtitle{text-align:center;color:var(--text-dim);font-size:.85rem;margin-bottom:28px}
.grid{display:grid;gap:20px;margin-bottom:20px}
.grid-4{grid-template-columns:repeat(4,1fr)}
.grid-2{grid-template-columns:1fr 1fr}
.grid-3{grid-template-columns:1fr 1fr 1fr}
.card{background:var(--navy);border:1px solid var(--navy-lighter);border-radius:12px;padding:20px;position:relative;overflow:hidden}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--gold),transparent)}
.card h2{font-size:.75rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--gold);margin-bottom:14px;font-weight:600}
.stat-card{text-align:center;padding:24px 16px}
.stat-card .value{font-size:2.6rem;font-weight:700;color:var(--text);line-height:1}
.stat-card .label{font-size:.7rem;text-transform:uppercase;letter-spacing:1.5px;color:var(--text-dim);margin-top:8px}
.stat-card .sub{font-size:.75rem;color:var(--gold);margin-top:4px}

/* Leaderboard */
table{width:100%;border-collapse:collapse;font-size:.85rem}
th{text-align:left;color:var(--text-dim);font-weight:500;padding:8px 10px;border-bottom:1px solid var(--navy-lighter);font-size:.7rem;text-transform:uppercase;letter-spacing:1px}
td{padding:10px;border-bottom:1px solid rgba(45,65,104,.4)}
tr:hover td{background:rgba(197,165,90,.04)}
.status{display:inline-block;padding:2px 10px;border-radius:20px;font-size:.7rem;font-weight:600;letter-spacing:.5px}
.status-idle{background:rgba(136,153,170,.15);color:var(--text-dim)}
.status-active{background:rgba(96,165,250,.15);color:var(--in-progress);animation:pulse 2s infinite}
.status-done{background:rgba(74,222,128,.12);color:var(--success)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}
.agent-name{display:flex;align-items:center;gap:8px}
.agent-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}

/* Timeline */
.timeline-container{overflow-x:auto}
.timeline-row{display:flex;align-items:center;margin-bottom:6px}
.timeline-label{width:90px;flex-shrink:0;font-size:.75rem;color:var(--text-dim);text-align:right;padding-right:12px}
.timeline-track{flex:1;height:28px;position:relative;background:rgba(45,65,104,.3);border-radius:4px}
.timeline-bar{position:absolute;height:20px;top:4px;border-radius:4px;display:flex;align-items:center;padding:0 8px;font-size:.65rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:default;transition:opacity .2s}
.timeline-bar:hover{opacity:.85!important}
.timeline-header{display:flex;margin-bottom:8px}
.timeline-header .timeline-label{visibility:hidden}
.timeline-header .timeline-track{display:flex;justify-content:space-between;font-size:.6rem;color:var(--text-dim);align-items:flex-end;padding-bottom:2px}

/* Quality */
.quality-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(45,65,104,.4)}
.quality-row:last-child{border:none}
.quality-label{font-size:.85rem}
.quality-value{font-size:1.3rem;font-weight:700}
.quality-bar{flex:1;margin:0 16px;height:6px;background:var(--navy-lighter);border-radius:3px;overflow:hidden}
.quality-fill{height:100%;border-radius:3px;transition:width .8s ease}

/* Cost */
.cost-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(45,65,104,.4);font-size:.85rem}
.cost-row:last-child{border:none}
.cost-tokens{color:var(--text-dim);font-size:.75rem}
.cost-amount{color:var(--gold);font-weight:600}

/* Chart */
.chart-wrap{position:relative;height:220px}

/* Responsive */
@media(max-width:900px){.grid-4{grid-template-columns:repeat(2,1fr)}.grid-2,.grid-3{grid-template-columns:1fr}}
@media(max-width:500px){.grid-4{grid-template-columns:1fr}.stat-card .value{font-size:1.8rem}.stat-card{padding:16px 12px}body{padding:12px}h1{font-size:1.3rem!important}.subtitle{font-size:.75rem}.cost-row{font-size:.78rem;flex-wrap:wrap}.timeline-label{width:60px;font-size:.65rem}}
</style>
</head>
<body>

<h1>‚ö° AGENT PERFORMANCE DASHBOARD</h1>
<p class="subtitle">Kit's Multi-Agent Team &mdash; <script>document.write(new Date().toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric',timeZone:'America/New_York'}))</script> &mdash; Sprint 4</p>

<!-- TODAY'S STATS -->
<div class="grid grid-4">
  <div class="card stat-card">
    <div class="value">9</div>
    <div class="label">Tasks Completed</div>
    <div class="sub">+1 in progress</div>
  </div>
  <div class="card stat-card">
    <div class="value">10m 04s</div>
    <div class="label">Total Build Time</div>
    <div class="sub">Avg 1m 41s / task</div>
  </div>
  <div class="card stat-card">
    <div class="value" style="color:var(--success)">90%</div>
    <div class="label">Success Rate</div>
    <div class="sub">9 of 10 first-pass</div>
  </div>
  <div class="card stat-card">
    <div class="value">~4,280</div>
    <div class="label">Lines Generated</div>
    <div class="sub">HTML, JS, CSS, MD</div>
  </div>
</div>

<!-- LEADERBOARD + TIMELINE -->
<div class="grid grid-2">
  <div class="card">
    <h2>üèÜ Agent Leaderboard</h2>
    <table>
      <thead><tr><th>Agent</th><th>Tasks</th><th>Avg Time</th><th>Pass Rate</th><th>Status</th></tr></thead>
      <tbody>
        <tr><td><div class="agent-name"><span class="agent-dot" style="background:#60A5FA"></span>Researcher</div></td><td>2</td><td>1m 40s</td><td>100%</td><td><span class="status status-active">‚óè Active</span></td></tr>
        <tr><td><div class="agent-name"><span class="agent-dot" style="background:#A78BFA"></span>Coder</div></td><td>1</td><td>2m 33s</td><td>100%</td><td><span class="status status-idle">Idle</span></td></tr>
        <tr><td><div class="agent-name"><span class="agent-dot" style="background:#F472B6"></span>Ops</div></td><td>1</td><td>1m 53s</td><td>100%</td><td><span class="status status-idle">Idle</span></td></tr>
        <tr><td><div class="agent-name"><span class="agent-dot" style="background:#34D399"></span>Analyst</div></td><td>1</td><td>1m 48s</td><td>100%</td><td><span class="status status-active">‚óè Active</span></td></tr>
        <tr><td><div class="agent-name"><span class="agent-dot" style="background:#FBBF24"></span>Writer</div></td><td>1</td><td>1m 10s</td><td>100%</td><td><span class="status status-idle">Idle</span></td></tr>
        <tr><td><div class="agent-name"><span class="agent-dot" style="background:var(--gold)"></span>Kit</div></td><td>3</td><td>‚Äî</td><td>100%</td><td><span class="status status-done">‚úì Done</span></td></tr>
      </tbody>
    </table>
  </div>

  <div class="card">
    <h2>üìÖ Task Timeline</h2>
    <div class="timeline-container">
      <div class="timeline-header">
        <div class="timeline-label"></div>
        <div class="timeline-track">
          <span>6:00</span><span>6:30</span><span>7:00</span><span>7:30</span><span>Now</span>
        </div>
      </div>
      <div class="timeline-row"><div class="timeline-label">Kit</div><div class="timeline-track">
        <div class="timeline-bar" style="left:2%;width:8%;background:var(--gold);opacity:.9">Cron Fix</div>
        <div class="timeline-bar" style="left:14%;width:6%;background:var(--gold);opacity:.9">Update</div>
        <div class="timeline-bar" style="left:24%;width:10%;background:var(--gold);opacity:.9">Security</div>
      </div></div>
      <div class="timeline-row"><div class="timeline-label">Researcher</div><div class="timeline-track">
        <div class="timeline-bar" style="left:30%;width:14%;background:#60A5FA">Backlog</div>
        <div class="timeline-bar" style="left:60%;width:30%;background:#60A5FA;opacity:.5;border:1px dashed #60A5FA">GH Landing ‚è≥</div>
      </div></div>
      <div class="timeline-row"><div class="timeline-label">Coder</div><div class="timeline-track">
        <div class="timeline-bar" style="left:38%;width:20%;background:#A78BFA">Racing Game</div>
      </div></div>
      <div class="timeline-row"><div class="timeline-label">Ops</div><div class="timeline-track">
        <div class="timeline-bar" style="left:44%;width:15%;background:#F472B6">Scrum Dash</div>
      </div></div>
      <div class="timeline-row"><div class="timeline-label">Analyst</div><div class="timeline-track">
        <div class="timeline-bar" style="left:52%;width:14%;background:#34D399">Spin-to-Win</div>
      </div></div>
      <div class="timeline-row"><div class="timeline-label">Writer</div><div class="timeline-track">
        <div class="timeline-bar" style="left:48%;width:10%;background:#FBBF24">EOS Framework</div>
      </div></div>
    </div>
  </div>
</div>

<!-- QUALITY + BURNDOWN + COST -->
<div class="grid grid-3">
  <div class="card">
    <h2>‚úÖ Quality Metrics</h2>
    <div class="quality-row">
      <span class="quality-label">First-pass success</span>
      <div class="quality-bar"><div class="quality-fill" style="width:90%;background:var(--success)"></div></div>
      <span class="quality-value" style="color:var(--success)">90%</span>
    </div>
    <div class="quality-row">
      <span class="quality-label">QA rejection rate</span>
      <div class="quality-bar"><div class="quality-fill" style="width:5%;background:var(--fail)"></div></div>
      <span class="quality-value" style="color:var(--fail)">5%</span>
    </div>
    <div class="quality-row">
      <span class="quality-label">Bugs post-ship</span>
      <div class="quality-bar"><div class="quality-fill" style="width:2%;background:#FBBF24"></div></div>
      <span class="quality-value" style="color:#FBBF24">1</span>
    </div>
    <div style="margin-top:16px;padding:12px;background:var(--navy-light);border-radius:8px;font-size:.75rem;color:var(--text-dim);text-align:center">
      üèÖ Team quality score: <span style="color:var(--gold);font-weight:700;font-size:.9rem">94 / 100</span>
    </div>
  </div>

  <div class="card">
    <h2>üìâ Sprint Burndown</h2>
    <div class="chart-wrap"><canvas id="burndown"></canvas></div>
  </div>

  <div class="card">
    <h2>üí∞ Cost Tracker</h2>
    <div class="cost-row"><span>Kit <span class="cost-tokens">~18K tokens</span></span><span class="cost-amount">$0.42</span></div>
    <div class="cost-row"><span>Researcher <span class="cost-tokens">~32K tokens</span></span><span class="cost-amount">$0.74</span></div>
    <div class="cost-row"><span>Coder <span class="cost-tokens">~45K tokens</span></span><span class="cost-amount">$1.04</span></div>
    <div class="cost-row"><span>Ops <span class="cost-tokens">~28K tokens</span></span><span class="cost-amount">$0.65</span></div>
    <div class="cost-row"><span>Analyst <span class="cost-tokens">~30K tokens</span></span><span class="cost-amount">$0.69</span></div>
    <div class="cost-row"><span>Writer <span class="cost-tokens">~22K tokens</span></span><span class="cost-amount">$0.51</span></div>
    <div style="margin-top:12px;padding:12px;background:var(--navy-light);border-radius:8px;display:flex;justify-content:space-between;align-items:center">
      <span style="font-size:.75rem;color:var(--text-dim)">Total today</span>
      <span style="font-size:1.3rem;font-weight:700;color:var(--gold)">$4.05</span>
    </div>
    <div style="text-align:center;margin-top:8px;font-size:.65rem;color:var(--text-dim)">~175K tokens ‚Ä¢ avg $0.45/task</div>
  </div>
</div>

<div style="text-align:center;padding:20px;font-size:.65rem;color:var(--text-dim)">
  Agent Performance Dashboard v1.0 &mdash; Built by Analyst Agent &mdash; OpenClaw Multi-Agent System
</div>
<div id="liveIndicator" style="position:fixed;bottom:12px;right:12px;padding:4px 10px;border-radius:12px;font-size:11px;font-weight:600;background:rgba(0,0,0,0.6);color:#888;z-index:9999;">‚è≥ Connecting...</div>

<script>
// ============================================================
// Live API Integration
// ============================================================
const LIVE_API_URL = 'https://dashboard.kitswarroom.com/api/status';
const LIVE_API_KEY = '689b1f85c91ffc61ef7469ea7b4c75f796a7025848bb3c7c';

const agentColors = {
  Kit: 'var(--gold)', Researcher: '#60A5FA', Coder: '#A78BFA',
  Ops: '#F472B6', Analyst: '#34D399', Writer: '#FBBF24', Comms: '#F97316', Qa: '#06B6D4'
};
const statusClassMap = { working: 'status-active', idle: 'status-idle', complete: 'status-done', blocked: 'status-active' };
const statusLabelMap = { working: '‚óè Active', idle: 'Idle', complete: '‚úì Done', blocked: '‚ö† Blocked' };

async function fetchLiveData() {
  const indicator = document.getElementById('liveIndicator');
  try {
    const res = await fetch(LIVE_API_URL, { headers: { 'X-API-Key': LIVE_API_KEY } });
    if (!res.ok) throw new Error('API error');
    const data = await res.json();
    updateAgentDashboard(data);
    indicator.textContent = 'üü¢ Live';
    indicator.style.color = '#4ADE80';
  } catch (e) {
    indicator.textContent = 'üî¥ Offline';
    indicator.style.color = '#F87171';
  }
}

function updateAgentDashboard(data) {
  // Update KPI cards
  const statCards = document.querySelectorAll('.stat-card');
  if (statCards.length >= 4 && data.stats) {
    const activeAgents = data.agents.filter(a => a.status === 'working').length;
    const completedAgents = data.agents.filter(a => a.status === 'complete').length;
    statCards[0].querySelector('.value').textContent = data.stats.commits || statCards[0].querySelector('.value').textContent;
    statCards[0].querySelector('.sub').textContent = `${activeAgents} agents active`;
    statCards[2].querySelector('.sub').textContent = `${completedAgents} of ${data.agents.length} complete`;
    statCards[3].querySelector('.value').textContent = '~' + data.stats.linesOfCode.toLocaleString();
    statCards[3].querySelector('.sub').textContent = `${data.stats.files} files, ${data.stats.screens} screens`;
  }

  // Update leaderboard
  const tbody = document.querySelector('table tbody');
  if (tbody && data.agents) {
    tbody.innerHTML = data.agents.map(a => {
      const color = agentColors[a.name] || 'var(--text-dim)';
      const cls = statusClassMap[a.status] || 'status-idle';
      const label = statusLabelMap[a.status] || a.status;
      return `<tr>
        <td><div class="agent-name"><span class="agent-dot" style="background:${color}"></span>${a.name}</div></td>
        <td>${a.role}</td>
        <td>${a.model}</td>
        <td>${a.task || '‚Äî'}</td>
        <td><span class="status ${cls}">${label}</span></td>
      </tr>`;
    }).join('');
    // Update table header to match new columns
    const thead = document.querySelector('table thead tr');
    if (thead) thead.innerHTML = '<th>Agent</th><th>Role</th><th>Model</th><th>Task</th><th>Status</th>';
  }

  // Update timeline with activity feed
  const timelineContainer = document.querySelector('.timeline-container');
  if (timelineContainer && data.activity && data.activity.length > 0) {
    timelineContainer.innerHTML = data.activity.slice(0, 10).map(a => `
      <div style="display:flex;gap:12px;padding:8px 0;border-bottom:1px solid rgba(45,65,104,.4);align-items:flex-start;">
        <span style="font-size:.7rem;color:var(--text-dim);min-width:44px;font-variant-numeric:tabular-nums;">${a.time}</span>
        <span style="width:8px;height:8px;border-radius:50%;background:var(--gold);flex-shrink:0;margin-top:4px;"></span>
        <span style="font-size:.8rem;color:var(--text);flex:1;line-height:1.4;"><strong style="color:var(--gold-dim)">${a.agent}</strong> ‚Äî ${a.text}</span>
      </div>
    `).join('');
  }
}

fetchLiveData();
setInterval(fetchLiveData, 15000);

// Burndown Chart
const ctx = document.getElementById('burndown').getContext('2d');
const days = ['Day 1','Day 2','Day 3','Day 4','Day 5','Day 6','Day 7','Day 8','Day 9','Day 10'];
const ideal = [40,36,32,28,24,20,16,12,8,0];
const actual = [40,35,27,null,null,null,null,null,null,null];

new Chart(ctx, {
  type: 'line',
  data: {
    labels: days,
    datasets: [{
      label: 'Ideal',
      data: ideal,
      borderColor: 'rgba(197,165,90,0.3)',
      borderDash: [6,4],
      borderWidth: 2,
      pointRadius: 0,
      fill: false
    },{
      label: 'Actual',
      data: actual,
      borderColor: '#C5A55A',
      borderWidth: 3,
      pointBackgroundColor: '#C5A55A',
      pointRadius: 4,
      fill: {target:'origin',above:'rgba(197,165,90,0.08)'}
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {labels:{color:'#8899AA',font:{size:11},usePointStyle:true,pointStyle:'line'}},
      tooltip:{backgroundColor:'#1B2A4A',borderColor:'#C5A55A',borderWidth:1,titleColor:'#C5A55A',bodyColor:'#E8E6E1'}
    },
    scales: {
      x:{ticks:{color:'#8899AA',font:{size:10}},grid:{color:'rgba(45,65,104,0.4)'}},
      y:{ticks:{color:'#8899AA',font:{size:10}},grid:{color:'rgba(45,65,104,0.4)'},title:{display:true,text:'Story Points',color:'#8899AA',font:{size:10}}}
    }
  }
});
</script>
</body>
</html>
