<!DOCTYPE html>
<html lang="en">
<head><script src="../auth.js"></script><link rel="stylesheet" href="../responsive.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kit's Team - Command Center</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0a;
      color: #e0e0e0;
      height: 100vh;
      overflow: hidden;
    }

    .grid-background {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-image: 
        linear-gradient(rgba(255, 215, 0, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 215, 0, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      z-index: 0;
      animation: gridMove 20s linear infinite;
    }
    @keyframes gridMove { 0% { transform: translate(0,0); } 100% { transform: translate(50px,50px); } }

    .container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 12px 16px;
      position: relative;
      z-index: 1;
      gap: 10px;
    }

    /* Header - compact */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .header-left {
      display: flex;
      align-items: baseline;
      gap: 12px;
    }

    h1 {
      font-size: 1.4rem;
      font-weight: 700;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle { color: #666; font-size: 0.75rem; }

    /* Stats bar - single compact row */
    .stats-bar {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
      flex-wrap: wrap;
    }

    .stat-card {
      background: rgba(20, 20, 20, 0.8);
      border: 1px solid rgba(255, 215, 0, 0.15);
      border-radius: 8px;
      padding: 6px 14px;
      text-align: center;
      flex: 1;
      min-width: 80px;
    }

    .stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: #ffd700;
    }

    .stat-label {
      font-size: 0.6rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Main content - fill remaining space */
    .main-content {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 280px;
      gap: 10px;
      min-height: 0;
    }

    /* Agent grid - compact cards */
    .agents-section {
      position: relative;
      min-height: 0;
    }

    .agents-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 8px;
      height: 100%;
    }

    .agent-card {
      background: rgba(20, 20, 20, 0.8);
      border: 1px solid rgba(255, 215, 0, 0.15);
      border-radius: 10px;
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .agent-card:hover {
      border-color: rgba(255, 215, 0, 0.4);
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.1);
    }

    .agent-card.working {
      border-color: #ffd700;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
      animation: workingGlow 2s ease-in-out infinite;
    }
    @keyframes workingGlow {
      0%, 100% { box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }
      50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); }
    }

    .agent-card.complete { border-color: rgba(0, 255, 0, 0.25); }

    .agent-header {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .agent-emoji { font-size: 1.3rem; }

    .agent-info h3 {
      font-size: 0.9rem;
      color: #ffd700;
      line-height: 1.1;
    }

    .agent-role {
      font-size: 0.65rem;
      color: #777;
    }

    .agent-middle {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 4px 0;
    }

    .agent-status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 8px;
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .agent-status.idle { background: rgba(100,100,100,0.3); color: #888; }
    .agent-status.working { background: rgba(255,215,0,0.2); color: #ffd700; }
    .agent-status.complete { background: rgba(0,255,0,0.2); color: #00ff00; }

    .agent-task {
      font-size: 0.7rem;
      color: #999;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      flex: 1;
    }

    .agent-model {
      font-size: 0.6rem;
      color: #555;
    }

    /* Activity feed - scrollable sidebar */
    .activity-section {
      background: rgba(20, 20, 20, 0.8);
      border: 1px solid rgba(255, 215, 0, 0.15);
      border-radius: 10px;
      padding: 12px;
      overflow-y: auto;
      min-height: 0;
    }

    .activity-section h2 {
      color: #ffd700;
      font-size: 0.9rem;
      margin-bottom: 10px;
      position: sticky;
      top: 0;
      background: rgba(20, 20, 20, 0.95);
      padding-bottom: 6px;
    }

    .activity-item {
      padding: 6px 0;
      border-bottom: 1px solid rgba(255, 215, 0, 0.06);
    }

    .activity-item:last-child { border-bottom: none; }

    .activity-time { font-size: 0.65rem; color: #ffd700; }
    .activity-text { font-size: 0.75rem; color: #bbb; line-height: 1.3; }
    .activity-agent { font-size: 0.6rem; color: #666; }

    .activity-section::-webkit-scrollbar { width: 4px; }
    .activity-section::-webkit-scrollbar-track { background: transparent; }
    .activity-section::-webkit-scrollbar-thumb { background: rgba(255,215,0,0.2); border-radius: 2px; }

    #connections-canvas {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: -1;
    }

    .loading { text-align: center; padding: 20px; color: #666; font-size: 0.8rem; }

    /* Mobile responsive */
    @media (max-width: 768px) {
      body { overflow: auto; height: auto; }
      .container { height: auto; padding: 10px; gap: 8px; }
      .stats-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; }
      .stat-card { padding: 4px 6px; min-width: unset; }
      .stat-value { font-size: 0.9rem; }
      .stat-label { font-size: 0.5rem; }
      .main-content { grid-template-columns: 1fr; }
      .agents-grid { grid-template-columns: repeat(2, 1fr); grid-template-rows: auto; gap: 6px; }
      .agent-card { padding: 8px 10px; }
      .agent-emoji { font-size: 1rem; }
      .agent-info h3 { font-size: 0.8rem; }
      .activity-section { max-height: 300px; }
      h1 { font-size: 1.1rem; }
      .subtitle { font-size: 0.65rem; }
      #clock { font-size: 0.7rem; }
    }

    @media (max-width: 400px) {
      .stats-bar { grid-template-columns: repeat(3, 1fr); }
      .agent-info h3 { font-size: 0.75rem; }
      .agent-role { font-size: 0.55rem; }
    }
  </style>
</head>
<body>
  <div class="grid-background"></div>
  
  <div class="container">
    <header>
      <div class="header-left">
        <h1>KIT'S TEAM</h1>
        <span class="subtitle">Command Center ‚Ä¢ Real-Time</span>
      </div>
      <span class="subtitle" id="clock"></span>
    </header>

    <div class="stats-bar" id="stats-bar">
      <div class="loading">Loading...</div>
    </div>

    <div class="main-content">
      <div class="agents-section">
        <canvas id="connections-canvas"></canvas>
        <div class="agents-grid" id="agents-grid">
          <div class="loading">Loading agents...</div>
        </div>
      </div>

      <div class="activity-section">
        <h2>üì° Activity Feed</h2>
        <div id="activity-feed">
          <div class="loading">Loading...</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentData = null;

    function updateClock() {
      const now = new Date();
      document.getElementById('clock').textContent = 
        now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    }
    updateClock();
    setInterval(updateClock, 1000);

    async function fetchData() {
      try {
        const response = await fetch('/api/status');
        const data = await response.json();
        currentData = data;
        renderDashboard(data);
      } catch (error) {
        // Fallback to static data when API is unavailable (e.g., deployed to static host)
        const staticData = {
          stats: { linesOfCode: 14280, files: 43, screens: 23, components: 156, tsErrors: 0, commits: 38, uptime: 9720 },
          agents: [
            { name: "Kit", emoji: "‚ö°", role: "CEO / Orchestrator", status: "working", task: "Orchestrating Sprint 1", model: "claude-opus-4" },
            { name: "Coder", emoji: "üíª", role: "Full-Stack Developer", status: "idle", task: "5 builds shipped ‚Äî Racing Game, Deal Calculator, Trade Estimator, CSI Survey, Digital Cards", model: "claude-opus-4" },
            { name: "Researcher", emoji: "üî¨", role: "Research & Discovery", status: "idle", task: "4 builds shipped ‚Äî Master Backlog, GH Landing, Competitive Intel, People Analyzer", model: "claude-opus-4" },
            { name: "Writer", emoji: "‚úçÔ∏è", role: "Content & Docs", status: "idle", task: "4 builds shipped ‚Äî EOS Framework, Review Responder, L10 Runner, Onboarding", model: "claude-opus-4" },
            { name: "Analyst", emoji: "üìä", role: "Data & Visualization", status: "idle", task: "3 builds shipped ‚Äî Spin-to-Win, Agent Dashboard, Financial Dashboard, Marketing Tracker", model: "claude-opus-4" },
            { name: "Ops", emoji: "‚öôÔ∏è", role: "DevOps & Infrastructure", status: "idle", task: "3 builds shipped ‚Äî Scrum Dashboard, Service Scheduler, Sales Scorecard", model: "claude-opus-4" },
            { name: "QA", emoji: "üîç", role: "Quality Assurance", status: "idle", task: "Standby ‚Äî QA-RULES.md established", model: "claude-opus-4" },
            { name: "Comms", emoji: "üì¢", role: "Communications", status: "idle", task: "Standby", model: "claude-opus-4" }
          ],
          activity: [
            { time: "9:06 AM", text: "Kit's War Room deployed to kitswarroom.com", agent: "Kit" },
            { time: "8:43 AM", text: "CULTURE.md pushed to all agent workspaces ‚Äî mission, values, creator mindset", agent: "Kit" },
            { time: "8:23 AM", text: "QA-RULES.md created ‚Äî feedback loop institutionalized (IDS)", agent: "Kit" },
            { time: "7:36 AM", text: "Digital Business Cards shipped ‚Äî vCard, QR codes, hash routing", agent: "Coder" },
            { time: "7:35 AM", text: "Employee Onboarding Checklist shipped ‚Äî 4-phase wizard", agent: "Writer" },
            { time: "7:35 AM", text: "Inventory Browser shipped ‚Äî 45 vehicles, filters, lead capture", agent: "Researcher" },
            { time: "7:34 AM", text: "‚è∏Ô∏è Jeff paused new jobs ‚Äî completing in-flight builds", agent: "Kit" },
            { time: "7:32 AM", text: "Financial P&L Dashboard shipped ‚Äî 7 departments, store comparison", agent: "Analyst" },
            { time: "7:31 AM", text: "People Analyzer shipped ‚Äî GWC grid, The Bar, quarterly review", agent: "Researcher" },
            { time: "7:30 AM", text: "Trade-In Estimator shipped ‚Äî 4-step lead gen tool", agent: "Coder" },
            { time: "7:30 AM", text: "CSI Survey shipped ‚Äî smart routing happy‚Üíreview, unhappy‚Üírecovery", agent: "Coder" },
            { time: "7:29 AM", text: "Review Response Generator shipped ‚Äî 33+ templates, 3 tones", agent: "Writer" },
            { time: "7:28 AM", text: "Sales Daily Scorecard shipped ‚Äî store tabs, leaderboard, sparklines", agent: "Ops" },
            { time: "7:28 AM", text: "Competitive Intel Dashboard shipped ‚Äî 10 FL competitors profiled", agent: "Researcher" },
            { time: "7:25 AM", text: "Agent Performance Dashboard shipped ‚Äî Gantt, burndown, cost tracker", agent: "Analyst" },
            { time: "7:25 AM", text: "Deal Profit Calculator shipped ‚Äî front/back gross, OTD, live calcs", agent: "Coder" },
            { time: "7:24 AM", text: "GH Landing Page shipped ‚Äî full conversion funnel, market research", agent: "Researcher" },
            { time: "7:23 AM", text: "Spin-to-Win Lead Capture shipped ‚Äî prize wheel + lead form", agent: "Analyst" },
            { time: "7:22 AM", text: "Racing Game V1 shipped ‚Äî 4 Dyer brand cars, top-down racing", agent: "Coder" },
            { time: "7:21 AM", text: "Scrum Dashboard shipped ‚Äî Kanban, IDS, Rocks, activity feed", agent: "Ops" },
            { time: "7:20 AM", text: "Service Scheduler shipped ‚Äî 4-step wizard, .ics export", agent: "Ops" },
            { time: "7:18 AM", text: "L10 Meeting Runner shipped ‚Äî full EOS format with timers", agent: "Writer" },
            { time: "7:15 AM", text: "Team EOS Framework shipped ‚Äî docs/TEAM-EOS.md", agent: "Writer" },
            { time: "7:12 AM", text: "Master Backlog shipped ‚Äî 47 items prioritized", agent: "Researcher" },
            { time: "7:00 AM", text: "üöÄ Sprint 1 launched ‚Äî all agents activated", agent: "Kit" }
          ]
        };
        currentData = staticData;
        renderDashboard(staticData);
      }
    }

    function renderDashboard(data) {
      renderStats(data.stats);
      renderAgents(data.agents);
      renderActivity(data.activity);
      drawConnections();
    }

    function renderStats(stats) {
      document.getElementById('stats-bar').innerHTML = `
        <div class="stat-card"><div class="stat-value">${stats.linesOfCode.toLocaleString()}</div><div class="stat-label">Lines</div></div>
        <div class="stat-card"><div class="stat-value">${stats.files}</div><div class="stat-label">Files</div></div>
        <div class="stat-card"><div class="stat-value">${stats.screens}</div><div class="stat-label">Screens</div></div>
        <div class="stat-card"><div class="stat-value">${stats.components}</div><div class="stat-label">Components</div></div>
        <div class="stat-card"><div class="stat-value">${stats.tsErrors}</div><div class="stat-label">TS Errors</div></div>
        <div class="stat-card"><div class="stat-value">${stats.commits}</div><div class="stat-label">Commits</div></div>
        <div class="stat-card"><div class="stat-value">${formatUptime(stats.uptime)}</div><div class="stat-label">Uptime</div></div>
      `;
    }

    function renderAgents(agents) {
      document.getElementById('agents-grid').innerHTML = agents.map((agent, i) => `
        <div class="agent-card ${agent.status}" data-agent="${agent.name}" data-index="${i}">
          <div class="agent-header">
            <div class="agent-emoji">${agent.emoji}</div>
            <div class="agent-info">
              <h3>${agent.name}</h3>
              <div class="agent-role">${agent.role}</div>
            </div>
          </div>
          <div class="agent-middle">
            <div class="agent-status ${agent.status}">${agent.status}</div>
            <div class="agent-task" title="${agent.task}">${agent.task}</div>
          </div>
          <div class="agent-model">${agent.model}</div>
        </div>
      `).join('');
    }

    function renderActivity(activity) {
      const feed = document.getElementById('activity-feed');
      if (!activity.length) {
        feed.innerHTML = '<div class="activity-item"><div class="activity-text">No recent activity</div></div>';
        return;
      }
      feed.innerHTML = activity.map(item => `
        <div class="activity-item">
          <div class="activity-time">${item.time}</div>
          <div class="activity-text">${item.text}</div>
          <div class="activity-agent">${item.agent}</div>
        </div>
      `).join('');
    }

    function drawConnections() {
      const canvas = document.getElementById('connections-canvas');
      const ctx = canvas.getContext('2d');
      const section = document.querySelector('.agents-section');
      canvas.width = section.offsetWidth;
      canvas.height = section.offsetHeight;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const kitCard = document.querySelector('[data-agent="Kit"]');
      if (!kitCard || !currentData) return;

      const sRect = section.getBoundingClientRect();
      const kRect = kitCard.getBoundingClientRect();
      const kx = kRect.left - sRect.left + kRect.width / 2;
      const ky = kRect.top - sRect.top + kRect.height / 2;

      currentData.agents.forEach((agent, i) => {
        if (agent.status === 'working' && agent.name !== 'Kit') {
          const card = document.querySelector(`[data-index="${i}"]`);
          if (card) {
            const r = card.getBoundingClientRect();
            const ax = r.left - sRect.left + r.width / 2;
            const ay = r.top - sRect.top + r.height / 2;
            ctx.beginPath();
            ctx.moveTo(kx, ky);
            ctx.lineTo(ax, ay);
            ctx.strokeStyle = 'rgba(255, 215, 0, 0.25)';
            ctx.lineWidth = 1.5;
            ctx.shadowBlur = 8;
            ctx.shadowColor = 'rgba(255, 215, 0, 0.4)';
            ctx.stroke();
            ctx.shadowBlur = 0;
          }
        }
      });
    }

    function formatUptime(s) {
      const h = Math.floor(s / 3600);
      const m = Math.floor((s % 3600) / 60);
      return h > 0 ? `${h}h${m}m` : `${m}m`;
    }

    fetchData();
    setInterval(fetchData, 5000);
    window.addEventListener('resize', () => currentData && drawConnections());
  </script>
</body>
</html>
